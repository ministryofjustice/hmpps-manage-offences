{% extends "layout.njk" %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "partials/nav.njk" import navBar with context %}
{% from "govuk/components/breadcrumbs/macro.njk" import govukBreadcrumbs %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{%- from "govuk/components/tag/macro.njk" import govukTag -%}
{% from "partials/offenceDetailsSection.njk" import offenceDetailsSection %}
{% from "partials/inchoateTable.njk" import inchoateTable %}

{% set pageTitle = applicationName + " - View Offence" %}
{% set pageId = "view-offence" %}

{% block navBar %}
    {{ navBar('search') }}
{% endblock %}

{% block aside %}
    {{ govukBreadcrumbs({
        items: [
            {
                text: "Search " + offenceCodeSearch,
                href: "/search/offence-code?offenceCode=" + offenceCodeSearch
            },
            {
                text: "View " + offence.code
            }
        ]
    }) }}
{% endblock %}

{% block content %}

    <h1 class="govuk-heading-l">
        {{ offence.code }}: {{ offence.description }}
    </h1>

    {{ offenceDetailsSection(offence, parentOffence) }}

    <div class="govuk-grid-row govuk-body">
        <div class="govuk-grid-column-full">
            <h2 class="govuk-heading-m">Linked schedules</h2>
            {% if offence.schedules.length == 0 %}
                <p class="govuk-!-margin-bottom-0">None</p>
            {% else %}
                {% for schedule in offence.schedules %}
                    <div class="govuk-summary-card">
                        <div class="govuk-summary-card__title-wrapper"><h2 class="govuk-summary-card__title">
                                Schedule {{ schedule.code }}</h2>
                            <ul class="govuk-summary-card__actions">
                                <li class="govuk-summary-card__action">
                                    <a href="{{ schedule.url }}" rel="noreferrer noopener" target="_blank">View
                                        Legislation</a>
                                </li>
                            </ul>
                        </div>

                        <div class="govuk-summary-card__content">
                            <dl class="govuk-summary-list">
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Act</dt>
                                    <dd class="govuk-summary-list__value">{{ schedule.act }}</dd>
                                </div>
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Schedule and Part</dt>
                                    <dd class="govuk-summary-list__value">Schedule {{ schedule.code }}
                                        Part {{ schedule.partNumber }}</dd>
                                </div>
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Schedule Text</dt>
                                    <dd class="govuk-summary-list__value">{{ schedule.paragraphNumber }}
                                        . {{ schedule.paragraphTitle }}</dd>
                                </div>
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Line reference</dt>
                                    <dd class="govuk-summary-list__value">{{ schedule.lineReference }}</dd>
                                </div>
                                <div class="govuk-summary-list__row">
                                    <dt class="govuk-summary-list__key">Legislation</dt>
                                    <dd class="govuk-summary-list__value">{{ schedule.legislationText }}</dd>
                                </div>

                            </dl>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}

        </div>
    </div>

    {% if not offence.isChild %}
        <div class="govuk-grid-row govuk-body">
            <div class="govuk-grid-column-full">
                {% if not childOffences or childOffences.length == 0 %}
                    <h1 class="govuk-heading-m">Associated inchoate offences</h1>
                    <p class="govuk-!-margin-bottom-0">None</p>
                {% else %}
                    <h1 class="govuk-heading-m">Associated inchoate offences</h1>
                    {{ inchoateTable(childOffences) }}
                {% endif %}
            </div>
        </div>
    {% endif %}

    {{ govukButton({
        classes: "govuk-button--secondary govuk-!-margin-right-2",
        text: "Back",
        preventDoubleClick: true,
        href: "/search/offence-code?offenceCode=" + offenceCodeSearch,
        attributes: {  'data-qa': 'Back-view' }
    }) }}

{% endblock %}
